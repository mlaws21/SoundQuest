{"ast":null,"code":"const clientId = \"379e50830b614f5da69a1b198f950418\"; // Replace with your client id\nconst CALLBACK = \"http://localhost:3000/callback\";\nconst params = new URLSearchParams(window.location.search);\nconst code = params.get(\"code\");\nfunction populateUI(profile) {\n  var _profile$images$0$url, _profile$images$;\n  document.getElementById(\"displayName\").innerText = profile.display_name;\n  if (profile.images[0]) {\n    const profileImage = new Image(200, 200);\n    profileImage.src = profile.images[0].url;\n    document.getElementById(\"avatar\").appendChild(profileImage);\n  }\n  document.getElementById(\"id\").innerText = profile.id;\n  document.getElementById(\"email\").innerText = profile.email;\n  document.getElementById(\"uri\").innerText = profile.uri;\n  document.getElementById(\"uri\").setAttribute(\"href\", profile.external_urls.spotify);\n  document.getElementById(\"url\").innerText = profile.href;\n  document.getElementById(\"url\").setAttribute(\"href\", profile.href);\n  document.getElementById(\"imgUrl\").innerText = (_profile$images$0$url = (_profile$images$ = profile.images[0]) === null || _profile$images$ === void 0 ? void 0 : _profile$images$.url) !== null && _profile$images$0$url !== void 0 ? _profile$images$0$url : '(no profile image)';\n}\nfunction outputUI(profile) {\n  var _profile$images$0$url2, _profile$images$2;\n  document.getElementById(\"displayName\").innerText = profile.display_name;\n  if (profile.images[0]) {\n    const profileImage = new Image(200, 200);\n    profileImage.src = profile.images[0].url;\n    document.getElementById(\"avatar\").appendChild(profileImage);\n  }\n  const image = (_profile$images$0$url2 = (_profile$images$2 = profile.images[0]) === null || _profile$images$2 === void 0 ? void 0 : _profile$images$2.url) !== null && _profile$images$0$url2 !== void 0 ? _profile$images$0$url2 : '(no profile image)';\n  return profile.id, profile.email, profile.uri, image;\n}\nasync function fetchProfile(token) {\n  const result = await fetch(\"https://api.spotify.com/v1/me\", {\n    method: \"GET\",\n    headers: {\n      Authorization: `Bearer ${token}`\n    }\n  });\n  return await result.json();\n}\n\n// if (!code) {\n//     redirectToAuthCodeFlow(clientId);\n// } else {\n//     const accessToken = await getAccessToken(clientId, code);\n//     const profile = await fetchProfile(accessToken);\n//     console.log(profile); // Profile data logs to console\n\n//     populateUI(profile);\n// }\n\nexport async function redirectToAuthCodeFlow(clientId) {\n  const verifier = generateCodeVerifier(128);\n  const challenge = await generateCodeChallenge(verifier);\n  localStorage.setItem(\"verifier\", verifier);\n  const params = new URLSearchParams();\n  params.append(\"client_id\", clientId);\n  params.append(\"response_type\", \"code\");\n  params.append(\"redirect_uri\", CALLBACK);\n  params.append(\"scope\", \"user-read-private user-read-email\");\n  params.append(\"code_challenge_method\", \"S256\");\n  params.append(\"code_challenge\", challenge);\n  document.location = `https://accounts.spotify.com/authorize?${params.toString()}`;\n}\nasync function getAccessToken(clientId, code) {\n  const verifier = localStorage.getItem(\"verifier\");\n  const params = new URLSearchParams();\n  params.append(\"client_id\", clientId);\n  params.append(\"grant_type\", \"authorization_code\");\n  params.append(\"code\", code);\n  params.append(\"redirect_uri\", CALLBACK);\n  params.append(\"code_verifier\", verifier);\n  const result = await fetch(\"https://accounts.spotify.com/api/token\", {\n    method: \"POST\",\n    headers: {\n      \"Content-Type\": \"application/x-www-form-urlencoded\"\n    },\n    body: params\n  });\n  const {\n    access_token,\n    expires_in\n  } = await result.json();\n  const expirationTime = Date.now() + expires_in * 1000; // Convert seconds to milliseconds\n\n  localStorage.setItem('accessToken', access_token);\n  localStorage.setItem('tokenExpiration', expirationTime.toString());\n  return access_token;\n}\nfunction generateCodeVerifier(length) {\n  let text = '';\n  let possible = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';\n  for (let i = 0; i < length; i++) {\n    text += possible.charAt(Math.floor(Math.random() * possible.length));\n  }\n  return text;\n}\nasync function generateCodeChallenge(codeVerifier) {\n  const data = new TextEncoder().encode(codeVerifier);\n  const digest = await window.crypto.subtle.digest('SHA-256', data);\n  return btoa(String.fromCharCode.apply(null, [...new Uint8Array(digest)])).replace(/\\+/g, '-').replace(/\\//g, '_').replace(/=+$/, '');\n}\nexport async function authorize() {\n  const clientId = \"379e50830b614f5da69a1b198f950418\";\n  const params = new URLSearchParams(window.location.search);\n  const code = params.get(\"code\");\n  if (!code) {\n    redirectToAuthCodeFlow(clientId);\n    return;\n  }\n  const accessToken = await getAccessToken(clientId, code);\n  const profile = await fetchProfile(accessToken);\n  console.log(profile); // Profile data logs to console\n\n  return outputUI(profile);\n}\n\n// if (!isTokenValid()) {\n//     main();\n// }","map":{"version":3,"names":["clientId","CALLBACK","params","URLSearchParams","window","location","search","code","get","populateUI","profile","_profile$images$0$url","_profile$images$","document","getElementById","innerText","display_name","images","profileImage","Image","src","url","appendChild","id","email","uri","setAttribute","external_urls","spotify","href","outputUI","_profile$images$0$url2","_profile$images$2","image","fetchProfile","token","result","fetch","method","headers","Authorization","json","redirectToAuthCodeFlow","verifier","generateCodeVerifier","challenge","generateCodeChallenge","localStorage","setItem","append","toString","getAccessToken","getItem","body","access_token","expires_in","expirationTime","Date","now","length","text","possible","i","charAt","Math","floor","random","codeVerifier","data","TextEncoder","encode","digest","crypto","subtle","btoa","String","fromCharCode","apply","Uint8Array","replace","authorize","accessToken","console","log"],"sources":["/Users/mattlaws/personal/spotify_react/src/scripts.ts"],"sourcesContent":["interface UserProfile {\n    country: string;\n    display_name: string;\n    email: string;\n    explicit_content: {\n        filter_enabled: boolean,\n        filter_locked: boolean\n    },\n    external_urls: { spotify: string; };\n    followers: { href: string; total: number; };\n    href: string;\n    id: string;\n    images: Image[];\n    product: string;\n    type: string;\n    uri: string;\n}\n\ninterface Image {\n    url: string;\n    height: number;\n    width: number;\n}\n\n\nconst clientId = \"379e50830b614f5da69a1b198f950418\"; // Replace with your client id\nconst CALLBACK = \"http://localhost:3000/callback\"\n\nconst params = new URLSearchParams(window.location.search);\nconst code = params.get(\"code\");\n\nfunction populateUI(profile: UserProfile) {\n    document.getElementById(\"displayName\")!.innerText = profile.display_name;\n    if (profile.images[0]) {\n        const profileImage = new Image(200, 200);\n        profileImage.src = profile.images[0].url;\n        document.getElementById(\"avatar\")!.appendChild(profileImage);\n    }\n    document.getElementById(\"id\")!.innerText = profile.id;\n    document.getElementById(\"email\")!.innerText = profile.email;\n    document.getElementById(\"uri\")!.innerText = profile.uri;\n    document.getElementById(\"uri\")!.setAttribute(\"href\", profile.external_urls.spotify);\n    document.getElementById(\"url\")!.innerText = profile.href;\n    document.getElementById(\"url\")!.setAttribute(\"href\", profile.href);\n    document.getElementById(\"imgUrl\")!.innerText = profile.images[0]?.url ?? '(no profile image)';\n}\n\nfunction outputUI(profile: UserProfile) {\n    document.getElementById(\"displayName\")!.innerText = profile.display_name;\n    if (profile.images[0]) {\n        const profileImage = new Image(200, 200);\n        profileImage.src = profile.images[0].url;\n        document.getElementById(\"avatar\")!.appendChild(profileImage);\n    }\n\n    const image = profile.images[0]?.url ?? '(no profile image)'\n    return profile.id, profile.email, profile.uri, image;\n\n}\n\nasync function fetchProfile(token: string): Promise<UserProfile> {\n    const result = await fetch(\"https://api.spotify.com/v1/me\", {\n        method: \"GET\", headers: { Authorization: `Bearer ${token}` }\n    });\n\n    return await result.json();\n}\n\n// if (!code) {\n//     redirectToAuthCodeFlow(clientId);\n// } else {\n//     const accessToken = await getAccessToken(clientId, code);\n//     const profile = await fetchProfile(accessToken);\n//     console.log(profile); // Profile data logs to console\n    \n//     populateUI(profile);\n// }\n\n\n\n\nexport async function redirectToAuthCodeFlow(clientId: string) {\n    const verifier = generateCodeVerifier(128);\n    const challenge = await generateCodeChallenge(verifier);\n\n    localStorage.setItem(\"verifier\", verifier);\n\n    const params = new URLSearchParams();\n    params.append(\"client_id\", clientId);\n    params.append(\"response_type\", \"code\");\n    params.append(\"redirect_uri\", CALLBACK);\n    params.append(\"scope\", \"user-read-private user-read-email\");\n    params.append(\"code_challenge_method\", \"S256\");\n    params.append(\"code_challenge\", challenge);\n\n    document.location = `https://accounts.spotify.com/authorize?${params.toString()}`;\n}\n\n\nasync function getAccessToken(clientId: string, code: string): Promise<string> {\n    const verifier = localStorage.getItem(\"verifier\");\n\n    const params = new URLSearchParams();\n    params.append(\"client_id\", clientId);\n    params.append(\"grant_type\", \"authorization_code\");\n    params.append(\"code\", code);\n    params.append(\"redirect_uri\", CALLBACK);\n    params.append(\"code_verifier\", verifier!);\n\n    const result = await fetch(\"https://accounts.spotify.com/api/token\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/x-www-form-urlencoded\" },\n        body: params\n    });\n\n    const { access_token, expires_in } = await result.json();\n    const expirationTime = Date.now() + expires_in * 1000; // Convert seconds to milliseconds\n\n    localStorage.setItem('accessToken', access_token);\n    localStorage.setItem('tokenExpiration', expirationTime.toString());\n\n    return access_token;\n}\n\n\nfunction generateCodeVerifier(length: number) {\n    let text = '';\n    let possible = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';\n\n    for (let i = 0; i < length; i++) {\n        text += possible.charAt(Math.floor(Math.random() * possible.length));\n    }\n    return text;\n}\n\nasync function generateCodeChallenge(codeVerifier: string) {\n    const data = new TextEncoder().encode(codeVerifier);\n    const digest = await window.crypto.subtle.digest('SHA-256', data);\n    return btoa(String.fromCharCode.apply(null, [...new Uint8Array(digest)]))\n        .replace(/\\+/g, '-')\n        .replace(/\\//g, '_')\n        .replace(/=+$/, '');\n}\n\n\nexport async function authorize() {\n    const clientId = \"379e50830b614f5da69a1b198f950418\";\n    const params = new URLSearchParams(window.location.search);\n    const code = params.get(\"code\");\n\n    if (!code) {\n        redirectToAuthCodeFlow(clientId);\n        return;\n    }\n\n    const accessToken = await getAccessToken(clientId, code);\n    \n    const profile = await fetchProfile(accessToken);\n    console.log(profile); // Profile data logs to console\n    \n    return outputUI(profile);\n}\n\n// if (!isTokenValid()) {\n//     main();\n// }\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}